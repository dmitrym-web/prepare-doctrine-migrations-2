### Задача

Необходимо было сделать миграциив проекте, но! Чтобы генерировался `sql` файл, который можно было запускать без привяки к `php`, 
а главное не использовать `ORM`. Для препарирования была взята [Doctrine Migrations](https://www.doctrine-project.org/projects/migrations.html). 
Прочитав документации, я понял, что задача выполнима. Поставил свежий пакет(версия `3.4.1`) и начал вскрытие. 
Кстати автоматически был подтянут `DBAL`, но в контексте данной задачи он не пригодится.

В документации написанно, что при выполнении миграции можно использовать ключ `--write-sql` он как раз позвонляет сгенерировать вожделенный `sql` файл. 
Но не тут-то было... Помимо того, что была выполнена сама миграция, так еше сам `sql` файл, сгенерировался, не так, как описано в документации.

По идее должно было так:
```sql
-- Doctrine Migration File Generated on 2022-02-07 10:00:39

-- Version 20220207094911
CREATE TABLE projects(id SERIAL PRIMARY KEY, name VARCHAR(50) NOT NULL, description TEXT);
INSERT INTO doctrine_migration_versions (version, executed_at) VALUES ('20220207094911', CURRENT_TIMESTAMP);
```
А он сделал так:

```sql
-- Doctrine Migration File Generated on 2022-02-07 10:00:39

-- Version 20220207094911
CREATE TABLE projects(id SERIAL PRIMARY KEY, name VARCHAR(50) NOT NULL, description TEXT);
```

Полез на `GitHub` и в `Issues` и там нашел описание этого бага, который висит уже больше года: [тыц](https://github.com/doctrine/migrations/issues/1082). 
Разработчики не сильно заморачивалсь и поправили документацию, хотя в `Upgrade` они написали, что было изменено, 
а вот документации осталось по старому. Надо будет им напомнить. Года полтора назад, я находил пару багов, они оперативно исправили. 
А вот с этим непонятно, вдруг это фича?

В итоге поставл уже неподдерживаемую версию `2.3.5` и все заработало.

Чтобы пощупать, просто клонируйте репозиторий, запускайте докер.

### Вишенка на торте
Приятный момент, что можно сгенерировать `sql` файл, который будет генерировать, как миграцию, так и ее откат. 
Но это возможно с командой `execute` и соотвествующими ключами `--up` и `--down`.  

Да и в целом в пакете много ништяков, которые не попадают под поставленные задачи.

### Установка

`git clone git@github.com:nvrsk-yii2/prepare-doctrine-migrations-2.git`

`cd prepare-doctrine-migrations-2`

`make docker-up`

Остальные команды я описал [здесь](/docs/COMMANDS.md).

Я оставил пару миграций в репозитории для примера.
